{%- from "bird/map.jinja" import server with context %}
{%- macro set_interface_param(param_name, param_dict) -%}
{%- if param_dict.get(param_name, False) -%}
{%- if param_dict.get(param_name) == True -%}
{{ param_name }} yes;
{%- else -%}
{{ param_name }} {{ param_dict[param_name] }};
{%- endif -%}
{%- endif -%}
{%- endmacro -%}

protocol kernel {
	persist;
	scan time 20;
	export all;
}

protocol device {
	scan time 10;
}

protocol static {
}

{%- for protocol_name, protocol in server.protocol.iteritems() %}

{% if protocol.type == 'ospf' %}

protocol {{ protocol.type }} {{ protocol_name }} {
  {%- for param in server.protocol_params %}
  {{ set_interface_param(param, protocol) }}
  {%- endfor %}
  {%- for area_name, area in protocol.area.iteritems() %} 
  area {{ area_name }} {
    {%- for interface_name, interface in area.interface.iteritems() %}
    interface "{{ interface_name }}" {
      {%- for param in server.interface_params %}
      {{ set_interface_param(param, interface) }}
      {%- endfor %}
    };
    {%- endfor %}
  };
  {%- endfor %}
}

{%- endif %}

{%- endfor %}
